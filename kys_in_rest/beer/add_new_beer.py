import os

from kys_in_rest.beer.parse_beer import parse_style, parse_name
from kys_in_rest.core.tg_utils import TgFeature, SendTgMessageInterrupt, AskForData
from kys_in_rest.tg.entities.input_tg_msg import InputTgMsg


class AddNewBeer(TgFeature):

    def do(
        self,
        text: str | None,
        tg_user_id: int,
        msg: InputTgMsg | None = None,
    ) -> str:
        if int(tg_user_id) != int(os.environ["TG_ADMIN"]):
            raise SendTgMessageInterrupt("–¢–µ–±–µ –Ω–µ–ª—å–∑—è")

        if not text:
            raise AskForData("–°–∫–∏–Ω—å –ø–æ—Å—Ç –ø—Ä–æ –ø–∏–≤–æ")

        # todo ask for name
        name = "–ø–∏–≤–æ"
        # name = parse_name(msg.text)

        style = parse_style(msg.text)
        return f"üç∫ [{msg.forward_channel_name} ‚Äî {name} ‚Ä¢ _{style}_]({msg.forward_link})"
